<!DOCTYPE html>
<html>
	<head>
		<title>Impressions de France</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">

		<meta name="fragment" content="!">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">

		<link type="image/ico" rel="shortcut icon" href="resources/tpl/viewer/icons/favicon.ico">
		<link type="image/ico" rel="icon"  href="resources/tpl/viewer/icons/favicon.ico">
		<link rel="stylesheet" href="resources/lib/font-awesome/css/font-awesome.min.css">

		<!--
			To correctly reference your Map Journal in search engine:
			 - create and fill out extensively an ArcGIS Online item that link to your final application
			 - edit the following four tags as well as the title tag above on line 4
		-->
		<meta name="description" content="This story map was created with the Story Map Journal application in ArcGIS Online.">

		<!-- Facebook sharing -->


	<!--
			This application is released under the Apache License V2.0 by Esri http://www.esri.com/
			Checkout the project repository on GitHub to access source code, latest revision, developer documentation, FAQ and tips
			https://github.com/Esri/map-journal-storytelling-template-js
		-->

		<script type="text/javascript">
			//-------------------------------------------------------------------------------------------
			//     Application configuration (ignored on ArcGIS Online, Portal and during development)
			//-------------------------------------------------------------------------------------------
			var configOptions = {
				// Enter an application ID created through the Map Journal builder
				appid: "10456f25704d4ce09c06b37e8bcbbfb7",
				// Optionally to secure Journal's access, use an OAuth application ID (example: 6gyOg377fLUhUk6f)
				// User will need to sign-in to access the viewer even if your application is public
				oAuthAppId: "",
				// Optionally to be able to use the appid URL parameter, configure here the list of application author
				//  whose application are allowed to be viewed by this Map Journal deployment
				// This is the Portal username of the Journal owner (e.g. ["user1"], ["user1", "user2"])
				// To authorize all users you can use ["*"]
				authorizedOwners: [""]
			};
			// Optionally sharing and proxy URLs can be configured in app/config.js. This is only required
			//  when the webmap is not hosted on ArcGIS Online or a Portal for ArcGIS instance and the application isn't deployed as /home/MapJournal/ or /apps/MapJournal/.
			// Optionally Bing Maps key, Geometry and Geocode service's URLs can be configured in app/commonConfig.js. This is only required
			//  if the Organization or Portal for ArcGIS instance default configuration has to be overwritten. If the application is deployed
			//  on Portal for ArcGIS as /home/MapJournal/ or /apps/MapJournal/, that configuration is available in ../commonConfig.js
		</script>

		<!--
			Edit below at your own risk
		-->

		<script type="text/javascript">
			var app = {
				version: '1.6.1',
				pathJSAPI: '//js.arcgis.com/3.15/'
			};
		</script>
	</head>
	<body class="claro">
		<style>
		<!-- Audio Style -->
		<!-- Audio Style -->
			#removeable{margin-bottom: 5px;}
			#myckeck{margin-bottom: 5px;margin-right: 2px;}
			#playlist,audio{background:#666;width:400px; margin-bottom: 10px;}
			.active a{color:#5DB0E6;text-decoration:none;}
			.widget-content{padding-left: 5px;}
			#image{
				position:absolute;
				display: none;
				z-index:1001;
				}
			#image2{
				position:absolute;
				display: none;
				z-index:1001;
			}
			#streetv{margin-left: 5px; margin-bottom: 5px; margin-top: 2px; z-index:1000; position:absolute; left: 15px; top: 120px; border-color: #57585A;display: block;}
			.btn-minimize{margin-left: 5px; margin-bottom: 5px; margin-top: 2px;}
			#audiooff{margin-left: 5px; margin-bottom: 5px; margin-top: 2px;}
			li a{color:#eeeedd;background:#333;padding:5px;display:block;}
			li a:hover{text-decoration:none;}
		<!-- Audio Style -->
		<!-- Audio Style -->
		</style>

		<!-- Builder top panel is injected here -->
		<div id="builderPanel" class="hide mainViewAboveMap"></div>

		<!-- Content -->
		<div id="contentPanel" class="mobileView">
			<table class="containerPanelInner">
				<tr>
					<!-- Text panel of the Side Panel layout -->
					<td id="sidePanel">
						<div id="sidePanelInner" class="mainViewSideMap sidePanel sectionPanel">
							<div class="navDots vertical">
								<!-- navigation dots -->
							</div>
							<div class="header" aria-hidden="true">
								<div class="linkSocialContainer">
									<span class="linkContainer"></span>
									<span class="shareBtns">
										<i class="shareIcon blackHover share_facebook icon-facebook-squared" tabindex="-1"></i>
										<i class="shareIcon blackHover share_twitter icon-twitter" tabindex="-1"></i>
										<i class="shareIcon blackHover share_bitly icon-link" tabindex="-1"></i>
										<button type="button" class="switchBuilder btn btn-xs btn-primary" tabindex="-1"></button>
									</span>
								</div>
								
								<table class="logoContainer">
									<tr>
										<td class="logoWrapper">
											<a class="logoLink" target="_blank" tabindex="-1">
												<img class="logoImg"/>
											</a>
										</td>
									</tr>
								</table>
						
							</div>
				
							<div class="appTitle" tabindex="-1" aria-hidden="true"></div>
							<span class="error-status">
								<button class="btn btn-xs btn-warning check-story"></button>
							</span>
							<div class="separator"></div>
							<div class="sectionsWrapper">
								<div class="panelEditBtn">
									<div class="panelEditBtnInner"></div>
								</div>
								
											<!-- Street View Button -->
							
							<!--<button id="streetv" data-toggle="tooltip" data-placement="bottom" title="Google Street view" type="button" data-toggle="button" aria-pressed="false" autocomplete="off" class="btn btn-default btn-sm " >
								<span class="glyphicon glyphicon-road"></span>
							</button>
							
							<!-- Street View Button  -->
											<!-- Audio Player -->
							<!-- Audio Player -->
							<button id ="audiobutton" type="button" data-toggle="tooltip" data-placement="bottom" title="Show/Hide Playlist" class="btn btn-sm btn-default btn-minimize ">
								<span class="glyphicon glyphicon-list-alt"></span>
							</button>	
							
							<button id="audiooff" data-toggle="tooltip" data-placement="bottom" title="Turn Audio on/off" type="button" class="btn btn-default btn-sm showAudio" >
								<span class="glyphicon glyphicon-volume-up"></span>
							</button>
							
			
							<div id="removeable" class="widget-content" style="display:none;">
								<audio id="audio" preload="auto" tabindex="0" controls="autoplay" type="audio/mpeg">
									<source type="audio/mp3" src="music/1Debussy-Soloforflute.mp3">
									Sorry, your browser does not support HTML5 audio.
								</audio>
								<ul id="playlist">
									<li class="active"><a href="music/1Debussy-Soloforflute.mp3">Debussy - Syrinx</a></li>
									<li ><a href="music/2SaintSaens-Aquarium.mp3">Saint-Saens - Aquarium</a></li>
									<li ><a href="music/3Boieldieu-Concerto.mp3">Boieldieu - Rondeau</a></li>
									<li ><a href="music/4Debussy-Nocturnes.mp3">Debussy - Nocturnes</a></li>
									<li ><a href="music/5Offenbach-GaiteParisienne.mp3">Offenbach - Gaite Parisienne</a></li>
									<li ><a href="music/6Ravel-Daybreak.mp3">Ravel - Daybreak</a></li>
									<li ><a href="music/7Debussy-ClairdeLune.mp3">Debussy - ClairdeLune</a></li>
									<li ><a href="music/8ErikSatie-Gymnopedie.mp3">ErikSatie - Gymnopedie</a></li>
									<li ><a href="music/9SaintSaens-Finale.mp3">Saint-Saens - Finale</a></li>
									<li ><a href="music/10Dukas-Fanfare.mp3">Dukas - Fanfare</a></li>
									<li ><a href="music/11SaintSaens-4thMovement.mp3">Saint-Saens - 4th Movement</a></li>
								</ul>
							</div>
							<!-- Audio Player -->
							<!-- Audio Player-->
								<div class="sections">
									<!-- sections injected here -->
									
								</div>
	
							</div>
							<div class="builder builder-content-panel">
								<div class="builder-content-panel-group builder-add">
									<div class="builder-btn"></div>
									<div class="builder-lbl"></div>
								</div>
								<div class="builder-content-panel-group builder-organize">
									<div class="builder-btn"></div>
									<div class="builder-lbl"></div>
								</div>
							</div>
							<!-- <div class="resizer"></div> -->
							<div class="scroll">
								<div class="scrollInner" data-toggle="tooltip"></div>
							</div>
							<div class="builder-mask"></div>
							<div class="firstAddExplain"></div>
						</div>
					</td>
					<!-- Map -->
					<td id="mainStagePanel">
					<img id="image" src="http://gis.calhouncounty.org/WAB/V2.0/widgets/StreetView/widgets/StreetView/images/flying_gsv_man_e.png"/>
					<img id="image2" src="http://gis.calhouncounty.org/WAB/V2.0/widgets/StreetView/widgets/StreetView/images/flying_gsv_man_w.png"/>
						<div id="mainStagePanelInner">
							<div class="medias">
							<button id="streetv" data-toggle="tooltip" title="Google Street view" type="button" data-toggle="button" aria-pressed="false" autocomplete="off" class="btn btn-default btn-sm " >
								<!--<span class="glyphicon glyphicon-road"></span>-->
								<i class="fa fa-street-view" aria-hidden="true"></i>
							</button>
								<!-- Maps and media injected here -->
							</div>
							<div id="mainStageLoadingIndicator" class="loadingIndicator">
								<img src="resources/tpl/viewer/icons/loading-light.gif" />
							</div>
							<!-- Back button -->
							<div class="mediaBackContainer">
								<div class="backButton">
									<div class="backArrow"></div>
									<span class="backLbl"></span>
								</div>
							</div>
							<!-- Builder -->
							<div id="builderQuotes" class="centerAlignOnFloat"></div>
							<div id="builderLanding" class="centerAlignOnFloat"></div>
							<div id="builderHelp" class="centerAlignOnFloat"></div>
							<div class="firstAddExplain"></div>
						</div>
					</td>
				</tr>
			</table>
		</div>
		<!-- /Content -->

		<div id="floatingPanel" class="floatingPanel sectionPanel">
			<div class="backdrop"></div>
			<div class="header" aria-hidden="true">
				<div class="linkSocialContainer">
					<span class="linkContainer"></span>
					<span class="shareBtns">
						<i class="shareIcon blackHover share_facebook icon-facebook-squared" title="Share on Facebook" tabindex="-1"></i>
						<i class="shareIcon blackHover share_twitter icon-twitter" title="Share on Twitter" tabindex="-1"></i>
						<i class="shareIcon blackHover share_bitly icon-link" title="Share a short link" tabindex="-1"></i>
						<button type="button" class="switchBuilder btn btn-xs btn-primary" tabindex="-1"></button>
					</span>
				</div>
				<table class="logoContainer">
					<tr>
						<td class="logoWrapper">
							<a class="logoLink" target="_blank" tabindex="-1">
								<img class="logoImg"/>
							</a>
						</td>
					</tr>
				</table>
			</div>
			<div class="appTitle" tabindex="-1" aria-hidden="true"></div>
			<span class="error-status">
				<button class="btn btn-xs btn-warning check-story"></button>
			</span>
			<div class="separator"></div>
			<div class="panelEditBtn">
				<div class="panelEditBtnInner"></div>
			</div>
			<div class="sections">
				<div class="swiper-container">
					<div class="swiper-wrapper">
						<!-- sections injected here -->
					</div>
				</div>
			</div>
			<div class="builder builder-content-panel">
				<div class="builder-content-panel-group builder-add">
					<div class="builder-btn"></div>
					<div class="builder-lbl"></div>
				</div>
				<div class="builder-content-panel-group builder-organize">
					<div class="builder-btn"></div>
					<div class="builder-lbl"></div>
				</div>
			</div>
			<div class="navDots vertical">
				<!-- navigation dots -->
			</div>
			<div class="scroll">
				<div class="scrollInner" data-toggle="tooltip"></div>
			</div>
			<div class="builder-mask"></div>
			<div class="firstAddExplain"></div>
		</div>

		<!-- Mobile -->
		<div id="mobileView" class="floatingSwiper">
			<div class="swiper-container">
				<div class="backdrop"></div>
				<div class="embed-btn-container embed-btn-left">
					<div class="embed-btn"></div>
				</div>
				<div class="swiper-wrapper">
					<!-- sections injected here -->
				</div>
				<div class="embed-btn-container embed-btn-right">
					<div class="embed-btn"></div>
				</div>
			</div>
			<div class="header">
				<div class="backdrop"></div>
				<div class="linkSocialContainer">
					<span class="linkContainer"></span>
					<span class="shareBtns">
						<i class="shareIcon share_facebook icon-facebook-squared"></i>
						<i class="shareIcon share_twitter icon-twitter"></i>
						<i class="shareIcon share_bitly icon-link"></i>
					</span>
				</div>
			</div>
		</div>

		<!-- Loading -->
		<style>
			#loadingOverlay {
				position: absolute;
				top: 0;
				left: 0;
				z-index: 1100;
				width: 100%;
				height: 100%;
				overflow: hidden;
				background-color: #E5E5E5;
				-webkit-box-shadow: inset 0px 0px 82px 19px rgba(0,0,0,0.3);
				-moz-box-shadow: inset 0px 0px 82px 19px rgba(0,0,0,0.3);
				box-shadow: inset 0px 0px 82px 19px rgba(0,0,0,0.3);
			}
			@keyframes fadein { from { opacity: 0; } to { opacity: 1; } }
			@-moz-keyframes fadein { from { opacity: 0; } to { opacity: 1; } }
			@-webkit-keyframes fadein { from { opacity: 0; } to { opacity: 1; } }
			@-ms-keyframes fadein { from { opacity: 0; } to { opacity: 1; } }
			@-o-keyframes fadein { from { opacity: 0; } to { opacity: 1; } }
			@keyframes fadeout { from { opacity: 1; } to { opacity: 0; } }
			@-moz-keyframes fadeout { from { opacity: 1; } to { opacity: 0; } }
			@-webkit-keyframes fadeout { from { opacity: 1; } to { opacity: 0; } }
			@-ms-keyframes fadeout { from { opacity: 1; } to { opacity: 0; } }
			@-o-keyframes fadeout { from { opacity: 1; } to { opacity: 0; } }
			#loadingOverlay.fadeOut {
				-webkit-animation: fadeout 1.1s;
				-moz-animation: fadeout 1.1s;
				-ms-animation: fadeout 1.1s;
				-o-animation: fadeout 1.1s;
				animation: fadeout 1.1s;
				-webkit-animation-fill-mode:forwards;
				-moz-animation-fill-mode:forwards;
				animation-fill-mode:forwards;
			}
			#loadingIndicator {
				position: fixed;
				top: 50%;
				left: 50%;
				z-index: 1101;
			}
			.loadingIndicator {
				margin-left: -17px;
				margin-top: -20px;
			}
		</style>

		<div id="loadingOverlay"></div>
		<div id="loadingIndicator" class="loadingIndicator">
			<img src="resources/tpl/viewer/icons/loading-light.gif" />
		</div>
		<div id="loadingMessage"></div> <!-- Share dialog --> <div class="modal fade shareDialog" id="shareDialog" role="dialog" data-backdrop="static" tabindex="-1"></div> <!-- Builder views are injected here --> <div id="builder-views"></div>

		<!-- Fatal error box -->
		<div id="fatalError">
			<table border="0">
				<tr>
					<td width="70px" align="center" id="fatalError-icon"></td>
					<td id="fatalError-msg">
						<b class="error-title"></b>
						<p class="error-msg"></p>
					</td>
				</tr>
			</table>
		</div>

		<script type="text/javascript" src="app/main-config.js"></script>

		<script type="text/javascript">
		require([
			'dojo/topic',
			"dojo/parser",
			"esri/geometry/webMercatorUtils",
			'dojo/_base/array'
		], function(
			topic,
			parser,
			webMercatorUtils,
			array
		) {
			var audio;
			var prevx = 1;
			var playlist;
			var tracks;
			var current;
			var thestreet;
			var streetcurs = "normal";
			var buttonvalue = "mini";
			var audioon = "yes";
			var mysong = "song value";
			init();
			function init(){
				
					topic.subscribe("tpl-ready", function(){
					app.map.on("click", function(evt) {
						if (app.data.getCurrentSectionIndex() !== 0){
			
						} else {
							if (evt.graphic._count > 0){
								console.log("Graphic clicked");
								sectionID = evt.graphic.attributes.Number;
								console.log(sectionID);
								topic.publish("story-navigate-section", sectionID);
								//topic.publish("story-navigate-entry", 2);

							} else {
								console.log("nothing");
							}
						}	
					});
				});
				
				current = 0;
				audio = $('audio');
				playlist = $('#playlist');
				tracks = playlist.find('li a');
				len = tracks.length;
				audio[0].volume = .50;
				//audio[0].play();
				playlist.find('a').click(function(e){
					e.preventDefault();
					link = $(this);
					current = link.parent().index();
					run(link, audio[0]);
				});
				/*
				audio[0].addEventListener('ended',function(e){
					current++;
					if(current === len){
						current = 0;
						link = playlist.find('a')[0];
					}else{
						link = playlist.find('a')[current];    
					}
					run($(link),audio[0]);
				}); */
				function run(link, player){
					player.src = link.attr('href');
					par = link.parent();
					par.addClass('active').siblings().removeClass('active');
					audio[0].load();
					audio[0].play();
				}
			<!-- Play Audio during certain sections -->	
				topic.subscribe('story-load-section', setmusic);
				function setmusic(evt){
				
						whatisit = app.data.getCurrentSection();
				infoIneed = whatisit.media.type;
				if (infoIneed == "webmap"){
					$("#streetv").fadeIn();
				} else {
					$("#streetv").hide();
				}
					if (audioon == "no"){
						audio[0].pause();
					
					} else{
					// No Audio on map home screen
					if (evt == 0) {
						audio[0].pause();
					// Play Song 1 when section 1 is active
					} else if (evt == 1) {	
						mysong = 0;
						link = playlist.find('a')[mysong];    
						run($(link),audio[0]);
					// Play Song 2 when section 2,3 or 4 are active	
					} else if (evt == 2 || evt == 3 || evt == 4) {
						if (mysong == 1){
						
						} else {
							mysong = 1;
							link = playlist.find('a')[mysong];    
							run($(link),audio[0]);
						}
					// Play Song 3 when section 3 is active	
					}else if (evt == 5 || evt == 6 || evt == 7) {	
						if (mysong == 2){
						
						} else {
							mysong = 2;
							link = playlist.find('a')[mysong];    
							run($(link),audio[0]);
						}
					// No Audio when section four is active	
					}else if (evt == 14) {
							if (mysong == 3){
						
						} else {
							mysong = 3;
							link = playlist.find('a')[mysong];    
							run($(link),audio[0]);
						}
					// Play Song 2 when section 5 is active	
					}else if (evt == 15 || evt == 16) {	
								if (mysong == 4){
						
						} else {
							mysong = 4;
							link = playlist.find('a')[mysong];    
							run($(link),audio[0]);
						}
					}else if (evt == 17 || evt == 18) {	
							if (mysong == 5){
						
						} else {
							mysong = 5;
							link = playlist.find('a')[mysong];    
							run($(link),audio[0]);
						}
					}else if (evt == 19 ) {	
							if (mysong == 6){
						
						} else {
							mysong = 6;
							link = playlist.find('a')[mysong];    
							run($(link),audio[0]);
						}
					}  else if (evt == 20) {	
							if (mysong == 7){
						
						} else {
							mysong = 7;
							link = playlist.find('a')[mysong];    
							run($(link),audio[0]);
						}
					} else if (evt == 22) {	
							if (mysong == 1){
						
						} else {
							mysong = 1;
							link = playlist.find('a')[mysong];    
							run($(link),audio[0]);
						}
					} else if (evt == 28 || evt == 29 || evt == 30) {	
							if (mysong == 8){
						
						} else {
							mysong = 8;
							link = playlist.find('a')[mysong];    
							run($(link),audio[0]);
						}
					} else if (evt == 32) {	
							if (mysong == 6){
						
						} else {
							mysong = 6;
							link = playlist.find('a')[mysong];    
							run($(link),audio[0]);
						}
					} else if (evt == 33) {	
							if (mysong == 9){
						
						} else {
							mysong = 9;
							link = playlist.find('a')[mysong];    
							run($(link),audio[0]);
						}
					}else if (evt == 34) {	
							if (mysong == 10){
						
						} else {
							mysong = 10;
							link = playlist.find('a')[mysong];    
							run($(link),audio[0]);
						}
					}

				}
				}
			}
		// Audio Button
		$(".btn-minimize").click(function(){
			$(this).toggleClass('btn-plus');
			$(".widget-content").slideToggle();
		});
		
			topic.subscribe("story-perform-action-media", function(media){
		if (media.type == "webpage"){
			$("#streetv").hide();
		} else {
			$("#streetv").fadeIn();
		}
		console.log("A Main Stage action is performed:", media);
	});
	
	$(".mediaBackContainer").click(function(){
		$("#streetv").fadeIn();	
	});
		
		//////////////////////////////// AUDIO ///////////////////////////////////////////
		$("[data-toggle='tooltip']").tooltip({
			trigger : 'hover',
			container: 'body'
		});  

	
		$('#audiooff').on('click', function () {
			if(audioon == "yes") {
				audioon = "no";
				audio[0].pause();
			} else {
				audioon = "yes";
		
			}
			this.blur();
			var $el = $(this),
            textNode = this.lastChild;
			$el.find('span').toggleClass('glyphicon-volume-off glyphicon-volume-up');
			$el.toggleClass('showAudio');
		});
///////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////
 $("#streetv").click(function () {
 
		 if (streetcurs == "street"){
			$(document).off("mousemove");
			streetcurs = "normal";
			//////////////
			$("#streetv").blur();
			/////////////
			thestreet.remove();	
		} else {
		$(document).mousemove(function(e){
		if (prevx > e.pageX ){
     document.getElementById('image').style.display = "block";
     document.getElementById('image2').style.display = "none";
      prevx = e.pageX;
    } else if (prevx < e.pageX)  {
     document.getElementById('image2').style.display = "block";
     document.getElementById('image').style.display = "none";
     }
    	$("#image2").css({left:e.pageX - 20, top:e.pageY - 40});
      $("#image").css({left:e.pageX - 20, top:e.pageY - 40});
      prevx = e.pageX;
    
});	

			streetcurs = "street";
		
		
		var thestreet = app.map.on("click", function(evt) {
				$("#streetv").blur();

				console.log(evt);
				xycoor = webMercatorUtils.webMercatorToGeographic(evt.mapPoint);
				console.log(xycoor);
				Lati = xycoor.y;
				Longi = xycoor.x;
				streetviewurl = "http://maps.google.com/?cbll=" + Lati + "," + Longi + "&cbp=12,20.09,,0,5&layer=c";
				console.log(streetviewurl);
				streetcurs = "normal";
				var win = window.open(streetviewurl, '_blank');
				win.focus();
				$(document).off("mousemove");
				thestreet.remove();	
		});
		}
    });
	/////////////////// Street View //////////////////////////////////////////////
	
	});
		</script>
	</body>
</html>